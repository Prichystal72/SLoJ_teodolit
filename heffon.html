<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Celestial Theodolite Calculator</title>
  <style>
    :root {
      --primary: #2c3e50;
      --accent: #3498db;
      --success: #27ae60;
      --warning: #f39c12;
      --danger: #e74c3c;
      --light: #ecf0f1;
      --dark: #34495e;
      --radius: 8px;
      --shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: var(--primary);
      background-color: #f9fbfd;
      padding: 20px;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
    }
    header {
      text-align: center;
      margin-bottom: 30px;
      padding: 20px;
      background: white;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    header img.logo {
      height: 60px;
      margin-bottom: 15px;
    }
    h1 {
      font-size: 2.2rem;
      margin-bottom: 10px;
      color: var(--dark);
    }
    .subtitle {
      color: var(--dark);
      opacity: 0.8;
    }
    .images-section {
      display: flex;
      justify-content: space-between;
      gap: 20px;
      margin: 20px 0 30px;
    }
    .image-placeholder {
      flex: 1;
      height: 200px;
      background: #e0e7ff;
      border: 2px dashed #a3bffa;
      border-radius: var(--radius);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #4f46e5;
      font-size: 0.9rem;
      text-align: center;
      padding: 10px;
    }
    .input-section, .results-section {
      background: white;
      padding: 25px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      margin-bottom: 30px;
    }
    h2 {
      margin-bottom: 20px;
      color: var(--dark);
      padding-bottom: 10px;
      border-bottom: 2px solid var(--light);
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }
    .form-group {
      margin-bottom: 12px;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      font-size: 0.95rem;
    }
    input, select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: var(--radius);
      font-size: 1rem;
    }
    button {
      background: var(--accent);
      color: white;
      border: none;
      padding: 12px 24px;
      font-size: 1.1rem;
      font-weight: 600;
      border-radius: var(--radius);
      cursor: pointer;
      transition: background 0.3s;
    }
    button:hover {
      background: #2980b9;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      padding: 14px;
      text-align: center;
      border-bottom: 1px solid #eee;
    }
    th {
      background-color: var(--primary);
      color: white;
    }
    tr:nth-child(even) {
      background-color: #f8f9fa;
    }
    .conclusive {
      color: var(--success);
      font-weight: bold;
    }
    .inconclusive {
      color: var(--danger);
    }
    .notes {
      margin-top: 20px;
      padding: 15px;
      background: #e8f4fc;
      border-left: 4px solid var(--accent);
      border-radius: 0 var(--radius) var(--radius) 0;
      font-size: 0.95rem;
    }
    footer {
      text-align: center;
      margin-top: 30px;
      color: #7f8c8d;
      font-size: 0.9rem;
    }
    @media (max-width: 768px) {
      .images-section {
        flex-direction: column;
      }
      .grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <!-- LOGO -->  hodnoty ze stelária  2°05'38"   s refrakcí 2°18'50"  
      <img src="logo-space-league-of-justice.png" alt="Space League of Justice" class="logo">
      <h1>Celestial Theodolite Calculator</h1>
      <p class="subtitle">Compare Flat Earth vs. Globe Earth models using stellar occultation data</p>
    </header>

    <!-- IMAGE PLACEHOLDERS -->
    <div class="images-section">
      <!-- Image 1: H1 - Earth is flat -->
      <div style="flex: 1; background: white; border-radius: 8px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
        <h3 style="color: #666; margin-bottom: 5px;">KISS hypothesis</h3>
        <h4 style="color: green; font-size: 1.3rem; margin-bottom: 15px;">H₁: Earth is flat</h4>
        <svg width="100%" height="200" viewBox="0 0 600 200" xmlns="http://www.w3.org/2000/svg">
          <!-- Flat ground line -->
          <line x1="20" y1="170" x2="580" y2="170" stroke="black" stroke-width="3"/>
          
          <!-- Mountain 1 -->
          <path d="M 50 170 L 80 120 L 90 135 L 110 100 L 130 120 L 140 110 L 160 170 Z" 
                fill="white" stroke="black" stroke-width="3"/>
          
          <!-- Mountain 2 -->
          <path d="M 180 170 L 210 110 L 230 130 L 250 95 L 270 115 L 290 105 L 310 120 L 330 170 Z" 
                fill="white" stroke="black" stroke-width="3"/>
          
          <!-- Line of sight (dashed) -->
          <line x1="290" y1="115" x2="520" y2="155" stroke="gray" stroke-width="3" stroke-dasharray="10,5"/>
          
          <!-- Telescope -->
          <g transform="translate(510, 140)">
            <rect x="0" y="0" width="35" height="25" fill="black" stroke="black" stroke-width="2"/>
            <polygon points="35,5 45,0 45,30 35,25" fill="black"/>
            <!-- Tripod -->
            <line x1="15" y1="25" x2="10" y2="40" stroke="black" stroke-width="2"/>
            <line x1="20" y1="25" x2="25" y2="40" stroke="black" stroke-width="2"/>
            <line x1="15" y1="25" x2="20" y2="40" stroke="black" stroke-width="2"/>
          </g>
          
          <!-- Observer -->
          <circle cx="530" cy="150" r="8" fill="black"/>
          <line x1="530" y1="158" x2="530" y2="175" stroke="black" stroke-width="3"/>
          <line x1="530" y1="165" x2="520" y2="170" stroke="black" stroke-width="3"/>
          <line x1="530" y1="165" x2="540" y2="170" stroke="black" stroke-width="3"/>
          <line x1="530" y1="175" x2="520" y2="185" stroke="black" stroke-width="3"/>
          <line x1="530" y1="175" x2="540" y2="185" stroke="black" stroke-width="3"/>
        </svg>
      </div>
      
      <!-- Image 2: H1 vs H0 -->
      <div style="flex: 1; background: white; border-radius: 8px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
        <h3 style="color: #666; margin-bottom: 5px;">KISS hypothesis</h3>
        <h4 style="color: green; font-size: 1.1rem; margin-bottom: 3px;">H₁: Earth is flat</h4>
        <h4 style="color: red; font-size: 1.1rem; margin-bottom: 15px;">H₀: Earth is not flat</h4>
        <svg width="100%" height="200" viewBox="0 0 600 200" xmlns="http://www.w3.org/2000/svg">
          <!-- Curved ground line -->
          <path d="M 20 180 Q 300 140 580 180" fill="none" stroke="black" stroke-width="3"/>
          
          <!-- Mountain 1 on curve -->
          <g transform="translate(50, 175)">
            <path d="M 0 0 L 30 -60 L 40 -45 L 60 -75 L 80 -55 L 90 -65 L 110 0 Z" 
                  fill="white" stroke="black" stroke-width="3"/>
          </g>
          
          <!-- Mountain 2 on curve -->
          <g transform="translate(180, 160)">
            <path d="M 0 0 L 30 -50 L 50 -30 L 70 -60 L 90 -40 L 110 -50 L 130 -30 L 150 0 Z" 
                  fill="white" stroke="black" stroke-width="3"/>
          </g>
          
          <!-- Line of sight (dashed, tangent to curve) -->
          <line x1="290" y1="125" x2="520" y2="165" stroke="gray" stroke-width="3" stroke-dasharray="10,5"/>
          
          <!-- Telescope -->
          <g transform="translate(510, 150)">
            <rect x="0" y="0" width="35" height="25" fill="black" stroke="black" stroke-width="2"/>
            <polygon points="35,5 45,0 45,30 35,25" fill="black"/>
            <!-- Tripod -->
            <line x1="15" y1="25" x2="10" y2="40" stroke="black" stroke-width="2"/>
            <line x1="20" y1="25" x2="25" y2="40" stroke="black" stroke-width="2"/>
            <line x1="15" y1="25" x2="20" y2="40" stroke="black" stroke-width="2"/>
          </g>
          
          <!-- Observer -->
          <circle cx="530" cy="160" r="8" fill="black"/>
          <line x1="530" y1="168" x2="530" y2="185" stroke="black" stroke-width="3"/>
          <line x1="530" y1="175" x2="520" y2="180" stroke="black" stroke-width="3"/>
          <line x1="530" y1="175" x2="540" y2="180" stroke="black" stroke-width="3"/>
          <line x1="530" y1="185" x2="520" y2="195" stroke="black" stroke-width="3"/>
          <line x1="530" y1="185" x2="540" y2="195" stroke="black" stroke-width="3"/>
        </svg>
      </div>
    </div>

    <!-- INPUT SECTION -->
    <section class="input-section">
      <h2>Observation Input</h2>
      <div class="grid">
        <div class="form-group">
          <label>Peak Name</label>
          <input type="text" id="peakName" value="Pikes Peak">
        </div>
        <div class="form-group">
          <label>Star Name</label>
          <input type="text" id="starName" value="39 Aquarii">
        </div>
        <div class="form-group">
          <label>Observer Height (m)</label>
          <input type="number" id="hObs" value="2073" step="1">
        </div>
        <div class="form-group">
          <label>Peak Height (m)</label>
          <input type="number" id="hPeak" value="4300" step="1">
        </div>
        <div class="form-group">
          <label>Distance (m)</label>
          <input type="number" id="distance" value="50700" step="1">
        </div>
        <div class="form-group">
          <label>From Heffron to Peak (°)</label>
          <input type="number" id="thetaHeffronToPeak" value="2.282" step="0.0001">
        </div>
        <div class="form-group">
          <label>From Peak to Star (°)</label>
          <input type="number" id="thetaPeakToStar" value="2.738" step="0.0001">
        </div>
        <div class="form-group">
          <label>Earth Radius (m)</label>
          <input type="number" id="earthRadius" value="6371000" step="1000">
        </div>
      </div>
      <button onclick="calculate()">Calculate All Models</button>
    </section>

    <!-- RESULTS SECTION -->
    <section class="results-section">
      <h2>Model Comparison Results</h2>
      <table id="resultsTable">
        <thead>
          <tr>
            <th>Model</th>
            <th>Predicted ΔHeight (m)</th>
            <th>Height Error (m)</th>
            <th>Predicted Distance (m)</th>
            <th>Distance Error (m)</th>
            <th>Conclusion</th>
          </tr>
        </thead>
        <tbody id="resultsBody">
          <!-- Filled by JavaScript -->
        </tbody>
      </table>

      <div class="notes">
        <strong>Basic Model Comparison:</strong> 
        Height error ≤ ±60 m AND Distance error ≤ ±1,609 m → <span class="conclusive">Conclusive</span>.<br>
        <strong>Spherical Model:</strong> Uses complete spherical trigonometry as theoretical baseline for Earth curvature analysis.<br>
        <em>Legend: 🎯 = Within accuracy limits | 📊 = Best overall accuracy | 🔬 = Theoretical reference</em>
      </div>
    </section>

    <!-- MATHEMATICAL FORMULAS SECTION -->
    <section class="results-section">
      <h2>Mathematical Formulas for Each Model</h2>
      
      <div style="margin-bottom: 30px;">
        <h3 style="color: var(--dark); margin-bottom: 10px;">📐 Model 1: Flat Earth (FE)</h3>
        <div style="background: #f8f9fa; padding: 15px; border-left: 4px solid var(--danger); border-radius: 4px;">
          <p><strong>Assumption:</strong> Earth is flat, line of sight is straight</p>
          
          <div style="text-align: center; margin: 15px 0;">
            <svg width="500" height="200" xmlns="http://www.w3.org/2000/svg" style="border: 1px solid #ccc; background: #fff;">
              <!-- Flat ground line -->
              <line x1="50" y1="150" x2="450" y2="150" stroke="#8B4513" stroke-width="4"/>
              <text x="200" y="170" font-size="11" fill="#666">Flat Earth surface</text>
              
              <!-- Observer -->
              <circle cx="100" cy="140" r="5" fill="red"/>
              <text x="70" y="135" font-size="12" font-weight="bold" fill="red">Observer</text>
              <text x="75" y="190" font-size="10" fill="red">h = 2073m</text>
              
              <!-- Peak -->
              <circle cx="400" cy="120" r="5" fill="green"/>
              <text x="405" y="115" font-size="12" font-weight="bold" fill="green">Peak</text>
              <text x="380" y="190" font-size="10" fill="green">h = 4300m</text>
              
              <!-- Line of sight (straight) -->
              <line x1="100" y1="140" x2="400" y2="120" stroke="blue" stroke-width="2" stroke-dasharray="5,5"/>
              <text x="230" y="115" font-size="11" fill="blue">Straight line of sight</text>
              
              <!-- Distance annotation -->
              <line x1="100" y1="155" x2="400" y2="155" stroke="#666" stroke-width="1"/>
              <text x="220" y="175" font-size="11" fill="#666">d = 50,700 m</text>
              
              <!-- Angle theta -->
              <path d="M 150 140 L 130 140 A 30 30 0 0 1 135 125" fill="none" stroke="purple" stroke-width="2"/>
              <text x="140" y="130" font-size="13" font-weight="bold" fill="purple">θ</text>
              
              <!-- Height difference -->
              <line x1="395" y1="120" x2="395" y2="140" stroke="orange" stroke-width="2"/>
              <text x="360" y="135" font-size="10" fill="orange">Δh</text>
            </svg>
          </div>
          
          <p><strong>Formula:</strong></p>
          <p style="margin-left: 20px; font-family: 'Courier New', monospace;">
            θ<sub>FE</sub> = θ<sub>Heffron</sub> = <span id="thetaStarDisplay">0</span><br><br>
            
            <strong>Height prediction:</strong><br>
            Δh<sub>predicted</sub> = d × tan(θ<sub>Heffron</sub>)<br>
            Δh<sub>predicted</sub> = <span id="distanceDisplay">0</span> × tan(<span id="thetaStarDisplay2">0</span>) = <span id="deltaH_FE_display">0</span> m<br>
            <em>Actual Δh = <span id="deltaHActual">0</span> m</em><br>
            <strong>Height error = <span id="errorH_FE_display">0</span> m</strong><br><br>
            
            <strong>Distance prediction:</strong><br>
            d<sub>predicted</sub> = Δh / tan(θ<sub>Heffron</sub>)<br>
            d<sub>predicted</sub> = <span id="deltaHActual_FE">0</span> / tan(<span id="thetaStarDisplay_FE">0</span>) = <span id="distance_FE_display">0</span> m<br>
            <em>Actual d = <span id="distanceActual_FE">0</span> m</em><br>
            <strong>Distance error = <span id="errorD_FE_display">0</span> m</strong>
          </p>
          <p style="margin-top: 10px; font-size: 13px;">
            <strong>⚠️ Problem:</strong> Ignores Earth's curvature completely. Works only for very short distances.
          </p>
        </div>
      </div>

      <div style="margin-bottom: 30px;">
        <h3 style="color: var(--dark); margin-bottom: 10px;">🌍 Model 2: Globe Earth - Heffron Approximation</h3>
        <div style="background: #f8f9fa; padding: 15px; border-left: 4px solid var(--warning); border-radius: 4px;">
          <p><strong>Assumption:</strong> Earth is curved, uses "drop" approximation</p>
          
          <div style="text-align: center; margin: 15px 0;">
            <svg width="500" height="250" xmlns="http://www.w3.org/2000/svg" style="border: 1px solid #ccc; background: #fff;">
              <!-- Earth curve -->
              <path d="M 50 200 Q 250 160 450 200" fill="none" stroke="#8B4513" stroke-width="4"/>
              <text x="200" y="230" font-size="11" fill="#666">Curved Earth surface</text>
              
              <!-- Observer -->
              <circle cx="100" cy="190" r="5" fill="red"/>
              <text x="70" y="185" font-size="12" font-weight="bold" fill="red">Observer</text>
              
              <!-- Peak -->
              <circle cx="400" cy="185" r="5" fill="green"/>
              <text x="405" y="180" font-size="12" font-weight="bold" fill="green">Peak</text>
              
              <!-- Arc distance (along surface) -->
              <path d="M 100 195 Q 250 155 400 190" fill="none" stroke="orange" stroke-width="2" stroke-dasharray="3,3"/>
              <text x="220" y="150" font-size="11" fill="orange" font-weight="bold">d (arc) = 50,700 m</text>
              
              <!-- "Drop" annotation -->
              <line x1="400" y1="185" x2="400" y2="130" stroke="red" stroke-width="2"/>
              <text x="405" y="155" font-size="10" fill="red" font-weight="bold">drop = 202m</text>
              
              <!-- Tangent line (WRONG assumption) -->
              <line x1="100" y1="190" x2="400" y2="130" stroke="blue" stroke-width="2" stroke-dasharray="5,5"/>
              <text x="180" y="140" font-size="11" fill="blue">Line of sight</text>
              
              <!-- Height difference (corrected) -->
              <line x1="100" y1="190" x2="100" y2="130" stroke="purple" stroke-width="2"/>
              <text x="50" y="160" font-size="10" fill="purple">Δh - drop</text>
              <text x="45" y="175" font-size="10" fill="purple">= 2025m</text>
              
              <!-- ERROR indicator -->
              <rect x="150" y="20" width="200" height="60" fill="#fff3cd" stroke="#ff9800" stroke-width="2" rx="5"/>
              <text x="160" y="40" font-size="12" font-weight="bold" fill="#d32f2f">❌ FATAL ERROR:</text>
              <text x="160" y="58" font-size="10" fill="#333">Uses ARC distance 'd'</text>
              <text x="160" y="72" font-size="10" fill="#333">in RIGHT-ANGLE formula!</text>
            </svg>
          </div>
          
          <p><strong>Formulas:</strong></p>
          <p style="margin-left: 20px; font-family: 'Courier New', monospace;">
            <strong>Step 1: Calculate drop</strong><br>
            drop = d² / (2R)<br>
            drop = <span id="distanceDisplay2">0</span>² / (2 × <span id="radiusDisplay">0</span>) = <span id="dropDisplay">0</span> m<br><br>
            
            <strong>Step 2: Calculate angle</strong><br>
            θ<sub>Heffron</sub> = arctan((Δh - drop) / d)<br>
            θ<sub>Heffron</sub> = arctan((<span id="deltaHActual2">0</span> - <span id="dropDisplay2">0</span>) / <span id="distanceDisplay3">0</span>)<br>
            θ<sub>Heffron</sub> = arctan(<span id="deltaHMinusDrop">0</span> / <span id="distanceDisplay4">0</span>) = <span id="thetaHeffronDisplay">0</span><br><br>
            
            <strong>Step 3: Height prediction</strong><br>
            Δh<sub>predicted</sub> = d × tan(θ<sub>Heffron</sub>)<br>
            Δh<sub>predicted</sub> = <span id="distanceDisplay_Heffron">0</span> × tan(<span id="thetaHeffronDisplay2">0</span>) = <span id="deltaH_Heffron_display">0</span> m<br>
            <em>Actual Δh = <span id="deltaHActual_Heffron">0</span> m</em><br>
            <strong>Height error = <span id="errorH_Heffron_display">0</span> m</strong><br><br>
            
            <strong>Step 4: Distance prediction</strong><br>
            d<sub>predicted</sub> = Δh / tan(θ<sub>Heffron</sub>)<br>
            d<sub>predicted</sub> = <span id="deltaHActual_Heffron2">0</span> / tan(<span id="thetaHeffronDisplay3">0</span>) = <span id="distance_Heffron_display">0</span> m<br>
            <em>Actual d = <span id="distanceActual_Heffron">0</span> m</em><br>
            <strong>Distance error = <span id="errorD_Heffron_display">0</span> m</strong>
          </p>
          <p style="margin-top: 10px; font-size: 13px; background: #ffebee; padding: 10px; border-radius: 4px;">
            <strong>⚠️ CRITICAL PROBLEM:</strong> Uses arc distance 'd' (measured along curved surface) 
            in arctan formula that requires a STRAIGHT line distance! This is like using a tape measure 
            that bends around the Earth's curve, but treating it as if it were stretched tight. 
            The formula also ignores that local horizons are tilted on a sphere. 
            <strong>Systematically underestimates angles by ~<span id="angleUnderestimate">0</span>°!</strong>
          </p>
        </div>
      </div>

      <div style="margin-bottom: 30px;">
        <h3 style="color: var(--dark); margin-bottom: 10px;">✅ Model 3: Globe Earth - Correct Spherical Trigonometry</h3>
        <div style="background: #d4edda; padding: 15px; border-left: 4px solid var(--success); border-radius: 4px;">
          <p><strong>Assumption:</strong> Earth is curved, uses proper chord distance</p>
          <p><strong>Formulas:</strong></p>
          <p style="margin-left: 20px; font-family: 'Courier New', monospace;">
            <strong>Step 1:</strong> Calculate central angle<br>
            σ = d / R = <span id="distanceDisplay5">50,700</span> / <span id="radiusDisplay2">6,371,000</span> = <span id="sigmaDisplay">0.007970</span> rad<br><br>
            
            <strong>Step 2:</strong> Calculate distances from Earth's center<br>
            R<sub>O</sub> = R + h<sub>obs</sub> = <span id="radiusDisplay3">6,371,000</span> + <span id="hObsDisplay">2,073</span> = <span id="RODisplay">6,373,073</span> m<br>
            R<sub>P</sub> = R + h<sub>peak</sub> = <span id="radiusDisplay4">6,371,000</span> + <span id="hPeakDisplay">4,300</span> = <span id="RPDisplay">6,375,300</span> m<br><br>
            
            <strong>Step 3:</strong> Calculate CHORD distance (Law of Cosines)<br>
            L = √(R<sub>O</sub>² + R<sub>P</sub>² - 2·R<sub>O</sub>·R<sub>P</sub>·cos(σ))<br>
            L = √(<span id="RODisplay2">6,373,073</span>² + <span id="RPDisplay2">6,375,300</span>² - 2×<span id="RODisplay3">6,373,073</span>×<span id="RPDisplay3">6,375,300</span>×cos(<span id="sigmaDisplay2">0.007970</span>))<br>
            L = <span id="LDisplay">50,852.0</span> m<br>
            <em>(Note: <span id="chordArcDiff">74</span> m longer than arc distance!)</em><br><br>
            
            <strong>Step 4:</strong> Calculate angle α at observer (Law of Cosines)<br>
            cos(α) = (R<sub>O</sub>² + L² - R<sub>P</sub>²) / (2·R<sub>O</sub>·L)<br>
            α = arccos(cos(α)) = <span id="alphaDisplay">92.282°</span><br><br>
            
            <strong>Step 5:</strong> Correct for horizon "tilt" due to curvature<br>
            On a sphere, local horizons at observer and peak are tilted by σ<br>
            Base elevation angle (to peak): α - 90° = <span id="thetaBaseDisplay">2.282°</span><br>
            Correction for star observation: +σ = +<span id="sigmaCorrectionDisplay">0.457°</span><br>
            <strong>Star elevation angle: θ<sub>star</sub> = (α - 90°) + σ = <span id="thetaSphericalDisplay">2.738°</span></strong><br><br>
            
          <div style="text-align: center; margin: 20px 0;">
            <svg width="550" height="300" xmlns="http://www.w3.org/2000/svg" style="border: 1px solid #ccc; background: #f9f9f9;">
              <!-- Earth circle (surface) -->
              <circle cx="275" cy="220" r="100" fill="#4682B4" fill-opacity="0.3" stroke="#003366" stroke-width="3"/>
              <circle cx="275" cy="220" r="3" fill="#003366"/>
              <text x="230" y="238" font-size="11" font-weight="bold" fill="#003366">Earth center</text>
              
              <!-- Observer point (above surface on top, lower altitude) -->
              <circle cx="275" cy="115" r="5" fill="red"/>
              <text x="200" y="105" font-size="13" font-weight="bold" fill="red">A</text>
              
              <!-- Peak point (above surface, to the right, HIGHER altitude) -->
              <circle cx="345" cy="125" r="5" fill="green"/>
              <text x="350" y="120" font-size="13" font-weight="bold" fill="green">B</text>
              
              <!-- TRIANGLE - highlighted with thick lines -->
              <polygon points="275,220 275,115 345,125" fill="yellow" fill-opacity="0.15" stroke="black" stroke-width="3"/>
              
              <!-- Radii to actual observer and peak (R+h) - LABELED -->
              <line x1="275" y1="220" x2="275" y2="115" stroke="red" stroke-width="3"/>
              <text x="248" y="165" font-size="11" font-weight="bold" fill="red">RO</text>
              
              <line x1="275" y1="220" x2="345" y2="125" stroke="green" stroke-width="3"/>
              <text x="310" y="180" font-size="11" font-weight="bold" fill="green">RP</text>
              
              <!-- Chord distance L -->
              <line x1="275" y1="115" x2="345" y2="125" stroke="blue" stroke-width="3"/>
              <text x="305" y="112" font-size="12" font-weight="bold" fill="blue">L</text>
              
              <!-- Central angle sigma arc - EMPHASIZED -->
              <path d="M 275 185 A 35 35 0 0 1 303 200" fill="none" stroke="orange" stroke-width="3"/>
              <text x="290" y="205" font-size="16" font-weight="bold" fill="orange">σ</text>
              
              <!-- Angle alpha at observer - EMPHASIZED -->
              <path d="M 275 140 L 275 125 A 10 10 0 0 1 283 117" fill="none" stroke="purple" stroke-width="3"/>
              <text x="283" y="138" font-size="16" font-weight="bold" fill="purple">α</text>
              
              <!-- Local horizon lines -->
              <line x1="195" y1="115" x2="355" y2="115" stroke="red" stroke-width="2" stroke-dasharray="5,5"/>
              <line x1="290" y1="95" x2="400" y2="155" stroke="green" stroke-width="2" stroke-dasharray="5,5"/>
            </svg>
            <p style="margin-top: 10px; font-size: 12px; color: #666;">
              <em>Illustration: Spherical triangle geometry with proper chord distance calculation</em>
            </p>
          </div>
          
          <!-- New detailed view showing curved surface with correct horizon lines -->
          <div style="text-align: center; margin: 30px 0;">
            <svg width="600" height="300" xmlns="http://www.w3.org/2000/svg" style="border: 1px solid #ccc; background: #f9f9f9;">
              <!-- Curved Earth surface (arc segment) - much larger radius = very gentle curve -->
              <path d="M 50 250 Q 300 230 550 250" fill="none" stroke="#8B4513" stroke-width="6"/>
              <text x="250" y="280" font-size="12" fill="#666" font-weight="bold">Curved Earth Surface (large radius - very gentle curve)</text>
              
              <!-- Observer point on the curve (keeping original position) -->
              <circle cx="160" cy="220" r="6" fill="red"/>
              <text x="100" y="190" font-size="14" font-weight="bold" fill="red">Observer</text>
              <text x="105" y="205" font-size="11" fill="red">(h = 2073 m)</text>
              
              <!-- Peak point on the curve (keeping original position) -->
              <circle cx="440" cy="190" r="6" fill="green"/>
              <text x="450" y="160" font-size="14" font-weight="bold" fill="green">Peak</text>
              <text x="455" y="175" font-size="11" fill="green">(h = 4300 m)</text>
              
              <!-- Radius lines from center to observer and peak -->
              <line x1="300" y1="5230" x2="160" y2="220" stroke="black" stroke-width="1" opacity="0.5"/>
              <line x1="300" y1="5230" x2="440" y2="190" stroke="black" stroke-width="1" opacity="0.5"/>
              
              <!-- Line of sight (chord) - from observer to peak -->
              <line x1="160" y1="220" x2="440" y2="190" stroke="blue" stroke-width="3"/>
              <text x="245" y="190" font-size="12" font-weight="bold" fill="blue">Line of sight (L)</text>
              
              <!-- CORRECT local horizon for Observer - tangent to very gentle curve at observer position -->
              <line x1="60" y1="223" x2="260" y2="219" stroke="red" stroke-width="2" stroke-dasharray="8,4"/>
              <text x="20" y="234" font-size="11" fill="red" font-weight="bold">Observer's local horizon</text>
              
              <!-- CORRECT local horizon for Peak - tangent to very gentle curve at peak position -->
              <line x1="340" y1="188" x2="540" y2="192" stroke="green" stroke-width="2" stroke-dasharray="8,4"/>
              <text x="480" y="210" font-size="11" fill="green" font-weight="bold">Peak's local horizon</text>
              
              <!-- Arc distance annotation along the very gentle curve -->
              <path d="M 160 230.3 Q 300 223 440 230.3" fill="none" stroke="orange" stroke-width="2" stroke-dasharray="3,3"/>
              <text x="280" y="255" font-size="11" fill="orange" font-weight="bold">Arc distance (d)</text>
              
              <!-- Arrow markers -->
              <defs>
                <marker id="arrowred" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                  <polygon points="0 0, 10 3.5, 0 7" fill="red"/>
                </marker>
                <marker id="arrowgreen" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                  <polygon points="0 0, 10 3.5, 0 7" fill="green"/>
                </marker>
              </defs>
              
              <!-- Key insight box -->
              <rect x="20" y="20" width="560" height="60" fill="#fff3cd" stroke="#ff9800" stroke-width="2" rx="5"/>
              <text x="30" y="37" font-size="12" font-weight="bold" fill="#d32f2f">🔑 KEY INSIGHT (Doubled Radius):</text>
              <text x="30" y="52" font-size="11" fill="#333">With gentler Earth curvature, observer's horizon clearly passes UNDER the peak</text>
              <text x="30" y="67" font-size="11" fill="#333">This demonstrates why the σ correction is needed for proper spherical trigonometry</text>
            </svg>
            <p style="margin-top: 10px; font-size: 12px; color: #666;">
              <em>Detail view: Doubled radius shows how local horizons create elevation angle corrections on curved surfaces</em>
            </p>
          </div>
          
          <p style="margin-left: 20px; font-family: 'Courier New', monospace; margin-top: 20px;">
            <strong>Step 6: Model 3 Verification (Predicted vs. Measured)</strong><br><br>
            
            <strong>6A: Predicted height from spherical geometry:</strong><br>
            Δh<sub>predicted</sub> = R × (1 - cos(σ))<br>
            Δh<sub>predicted</sub> = <span id="deltaH_predicted_spherical_display">0</span> m<br><br>
            
            <strong>6B: Measured height from input angles:</strong><br>
            θ<sub>measured</sub> = θ<sub>peak→star</sub> - θ<sub>Heffron→peak</sub><br>
            θ<sub>measured</sub> = <span id="thetaPeakToStarDisplay">0</span>° - <span id="thetaHeffronToPeakDisplay">0</span>° = <span id="theta_measured_display">0</span> RAD<br>
            Δh<sub>measured</sub> = R × (1 - cos(θ<sub>measured</sub>))<br>
            Δh<sub>measured</sub> = <span id="deltaH_measured_spherical_display">0</span> m<br><br>
            
            <strong>6C: Errors for Model 3:</strong><br>
            Height error = Δh<sub>predicted</sub> - Δh<sub>measured</sub> = <span id="errorH_spherical_step6_display">0</span> m<br>
            Distance consistency check = d<sub>arc</sub> - (R × θ<sub>measured</sub>) = <span id="errorD_spherical_step6_display">0</span> m
          </p>
        </div>
      </div>


    </section>

    <footer>
      &copy; Jaroslav Prichystal | Space League of Justice | Celestial Theodolite Calculator v1.0
    </footer>
  </div>

  <script>
  function calculate() {
    console.log("Calculate started");
    
    // Get inputs
    const hObs = parseFloat(document.getElementById('hObs').value);
    const hPeak = parseFloat(document.getElementById('hPeak').value);
    const distance = parseFloat(document.getElementById('distance').value);
    const thetaHeffronToPeak = parseFloat(document.getElementById('thetaHeffronToPeak').value); // in degrees
    const thetaPeakToStar = parseFloat(document.getElementById('thetaPeakToStar').value); // in degrees
    const R = parseFloat(document.getElementById('earthRadius').value);
    
    // Calculate total angle from Heffron to star (sum of the two angles)
    const thetaTotal = thetaHeffronToPeak + thetaPeakToStar; // total angle in degrees
    const deltaH = hPeak - hObs;
    
    // For Flat Earth: should use only the angle to peak, no star correction
    const thetaFlatEarth = thetaHeffronToPeak; // Flat Earth assumes star is at peak
    const thetaFlatEarthRad = thetaFlatEarth * Math.PI / 180;
    const thetaTotalRad = thetaTotal * Math.PI / 180;

    // === FLAT EARTH MODEL ===
    const deltaH_FE = distance * Math.tan(thetaFlatEarthRad);
    const distance_FE = deltaH / Math.tan(thetaFlatEarthRad);
    const errorH_FE = deltaH_FE - deltaH;
    const errorD_FE = distance_FE - distance;

    // === GLOBE EARTH - HEFFRON APPROXIMATION ===
    const drop = (distance * distance) / (2 * R);
    const thetaGlobeHeffron = Math.atan((deltaH - drop) / distance);
    const deltaH_GE_Heffron = distance * Math.tan(thetaGlobeHeffron);
    const distance_GE_Heffron = deltaH / Math.tan(thetaGlobeHeffron);
    const errorH_GE_Heffron = deltaH_GE_Heffron - deltaH;
    const errorD_GE_Heffron = distance_GE_Heffron - distance;

    // === GLOBE EARTH - PRECISE SPHERICAL TRIGONOMETRY ===
  
    
    // Krok 1: Výpočet středového úhlu σ (úhel u středu Země mezi pozorovatelem a vrcholem)
    const sigma = distance / R; // σ = oblouková_vzdálenost / poloměr_Země
    
    // Krok 2: Vzdálenosti bodů od středu Země
    const RO = R + hObs;  // Pozorovatel: 6,371,000 + 2,073 = 6,373,073 m
    const RP = R + hPeak; // Vrchol: 6,371,000 + 4,300 = 6,375,300 m
    
    // Krok 3: Výpočet PŘÍMÉ vzdálenosti L mezi pozorovatelem a vrcholem
    // Použijeme kosinovu větu v trojúhelníku (střed Země - pozorovatel - vrchol):
    // L² = RO² + RP² - 2·RO·RP·cos(σ)
    const L = Math.sqrt(RO*RO + RP*RP - 2*RO*RP*Math.cos(sigma));
    // Výsledek: L ≈ 50,852 m (přímka vzduchem)
    // Porovnání: oblouková vzdálenost = 50,700 m (po povrchu)
    // Rozdíl: 74 m - toto je důležité!
    
    // Krok 4: Výpočet úhlu α u pozorovatele pomocí kosinovy věty
    // V trojúhelníku (střed Země - pozorovatel - vrchol) najdeme úhel α
    // cos(α) = (RO² + L² - RP²) / (2·RO·L)
    const cosAlpha = (RO*RO + L*L - RP*RP) / (2 * RO * L);
    const alpha = Math.acos(Math.max(-1, Math.min(1, cosAlpha)));
    
    // Krok 5: Korekce na "natočení" kvůli zakřivení
    // Base angle to peak (no correction)
    const thetaBase = alpha - Math.PI/2;
    
    // Star angle with horizon tilt correction - PLNÝ úhel σ
    const thetaGlobeSpherical = alpha - Math.PI/2 + sigma;
    
    // === MODEL 3: PURE SPHERICAL PREDICTION (bez použití vstupních úhlů) ===
    // Krok 6A: Predikce výšky pomocí POUZE sférické geometrie
    // Použijeme jen geometrické parametry: distance, hObs, hPeak, R
    // Správný vzorec pro predikci výšky na kouli: R(1 - cos(σ))
    const deltaH_predicted_spherical = R * (1 - Math.cos(sigma));
  
    const theta_Rad = (thetaPeakToStar-thetaHeffronToPeak) * Math.PI / 180;
    
    const deltaH_measured_from_angles = R * (1 - Math.cos(theta_Rad));

    // Chyby pro Model 3 (predikce vs. skutečnost)
     
    const errorH_GE_Spherical = deltaH_predicted_spherical - deltaH_measured_from_angles;  // R(1-cos(σ)) vs. skutečná výška
    const errorD_GE_Spherical = distance - (R * theta_Rad); // distance consistency check
    
    console.log("Step 6 variables:", {
      deltaH_predicted_spherical: deltaH_predicted_spherical,
      theta_Rad: theta_Rad,
      deltaH_measured_from_angles: deltaH_measured_from_angles,
      errorH_GE_Spherical: errorH_GE_Spherical,
      errorD_GE_Spherical: errorD_GE_Spherical
    });
    
    // Pro výstup do tabulky: používáme predikovanou výšku
    const deltaH_GE_Spherical = deltaH_predicted_spherical;
    const distance_GE_Spherical = deltaH / Math.tan(thetaGlobeSpherical);

    const chordArcDiff = L - distance;
    
    // Pro sférický model musíme přidat nové hodnoty
    const cosAlphaValue = (RO*RO + L*L - RP*RP) / (2 * RO * L);
    const alphaValue = Math.acos(Math.max(-1, Math.min(1, cosAlphaValue)));
    const thetaBaseValue = alphaValue - Math.PI/2;
    
    // Porovnání úhlů: predikovaný vs. měřený
    const angleErrorSpherical = (thetaGlobeSpherical - thetaTotalRad) * 180 / Math.PI;

    // VÝSLEDEK:
    // Tento výpočet používá SPRÁVNOU sférovou geometrii s kosinovou větou
    // a zohledňuje "natočení" lokálních horizontů kvůli zakřivení!
    // Očekávaná chyba: ~-1 m (téměř perfektní!)
    // Na rozdíl od Flat Earth (+40 m) a Heffrona (-202 m)    // Evaluation function - zvýšená přesnost pro detekci nejlepšího modelu
    function isConclusive(errH, errD) {
      return Math.abs(errH) <= 60 && Math.abs(errD) <= 1609;
    }
    
    // Najdeme model s nejmenší celkovou chybou
    function getTotalError(errH, errD) {
      return Math.abs(errH) + Math.abs(errD) / 100; // normalizace vzdálenosti
    }

    // Build results - only basic models for comparison
    const results = [
      {
        name: "Flat Earth (FE)",
        predH: deltaH_FE,
        errH: errorH_FE,
        predD: distance_FE,
        errD: errorD_FE,
        conclusive: isConclusive(errorH_FE, errorD_FE),
        totalError: getTotalError(errorH_FE, errorD_FE)
      },
      {
        name: "Globe Earth (Heffron)",
        predH: deltaH_GE_Heffron,
        errH: errorH_GE_Heffron,
        predD: distance_GE_Heffron,
        errD: errorD_GE_Heffron,
        conclusive: isConclusive(errorH_GE_Heffron, errorD_GE_Heffron),
        totalError: getTotalError(errorH_GE_Heffron, errorD_GE_Heffron)
      }
    ];
    
    // Separate spherical model for detailed analysis
    const sphericalModel = {
      name: "Globe Earth (Spherical)",
      predH: deltaH_GE_Spherical,
      errH: errorH_GE_Spherical,
      predD: distance,
      errD: errorD_GE_Spherical,
      conclusive: isConclusive(errorH_GE_Spherical, errorD_GE_Spherical),
      totalError: getTotalError(errorH_GE_Spherical, errorD_GE_Spherical)
    };
    
    // Find best model among basic models only
    const bestModel = results.reduce((best, current) => 
      current.totalError < best.totalError ? current : best
    );

    // Render table - basic models only
    const tbody = document.getElementById('resultsBody');
    tbody.innerHTML = '';
    
    results.forEach(model => {
      const isBest = model.name === bestModel.name;
      const row = tbody.insertRow();
      
      // Pokud je to nejlepší model, zvýrazníme celý řádek
      if (isBest) {
        row.style.backgroundColor = '#d4edda';
        row.style.fontWeight = 'bold';
      }
      
      row.innerHTML = `
        <td><strong>${model.name}${isBest ? ' ✓' : ''}</strong></td>
        <td>${model.predH.toFixed(1)}</td>
        <td class="${Math.abs(model.errH) <= 60 ? 'conclusive' : 'inconclusive'}">${model.errH.toFixed(1)}</td>
        <td>${model.predD.toFixed(0)}</td>
        <td class="${Math.abs(model.errD) <= 1609 ? 'conclusive' : 'inconclusive'}">${model.errD.toFixed(0)}</td>
        <td class="${isBest ? 'conclusive' : 'inconclusive'}">${isBest ? '✓ MOST ACCURATE' : 'Inaccurate'}</td>
      `;
    });
    
    // Add separator row
    const separatorRow = tbody.insertRow();
    separatorRow.innerHTML = `
      <td colspan="6" style="border-top: 3px solid #ccc; text-align: center; padding: 10px; font-weight: bold; background: #f8f9fa;">
        <em>Advanced Spherical Analysis</em>
      </td>
    `;
    
    // Add legend row for spherical model - as table cells
    const legendRow = tbody.insertRow();
    legendRow.style.backgroundColor = '#e3f2fd';
    legendRow.style.borderLeft = '4px solid #2196f3';
    legendRow.innerHTML = `
      <td style="padding: 10px; font-size: 0.85rem; color: #0d47a1; font-weight: bold;">
        <strong>Model</strong><br>
        <span style="font-weight: normal;">Spherical trigonometry</span>
      </td>
      <td style="padding: 10px; font-size: 0.85rem; color: #1565c0;">
        <strong>Predicted ΔHeight</strong><br>
        <span style="font-weight: normal;">Curvature-based height using R(1-cos(σ))</span>
      </td>
      <td style="padding: 10px; font-size: 0.85rem; color: #1976d2;">
        <strong>Height Error</strong><br>
        <span style="font-weight: normal;">Predicted vs measured curvature</span>
      </td>
      <td style="padding: 10px; font-size: 0.85rem; color: #1e88e5;">
        <strong>Predicted Distance</strong><br>
        <span style="font-weight: normal;">Arc distance from geometry</span>
      </td>
      <td style="padding: 10px; font-size: 0.85rem; color: #42a5f5;">
        <strong>Distance Error</strong><br>
        <span style="font-weight: normal;">Arc vs chord difference</span>
      </td>
      <td style="padding: 10px; font-size: 0.85rem; color: #64b5f6;">
        <strong>Conclusion</strong><br>
        <span style="font-weight: normal;">Theoretical baseline</span>
      </td>
    `;
    
    // Add spherical model row with special formatting
    const sphericalRow = tbody.insertRow();
    sphericalRow.style.backgroundColor = '#e3f2fd';
    sphericalRow.style.borderLeft = '4px solid #2196f3';
    
    // Determine spherical model status based on calculations
    let sphericalStatus = '';
    if (Math.abs(sphericalModel.errH) <= 60 && Math.abs(sphericalModel.errD) <= 1609) {
      sphericalStatus = '🎯 THEORETICAL BASELINE';
    } else if (sphericalModel.totalError < bestModel.totalError) {
      sphericalStatus = '📊 MOST ACCURATE';
    } else {
      sphericalStatus = '🔬 REFERENCE MODEL';
    }
    
    sphericalRow.innerHTML = `
      <td><strong>${sphericalModel.name}</strong></td>
      <td>${sphericalModel.predH.toFixed(1)}</td>
      <td class="${Math.abs(sphericalModel.errH) <= 60 ? 'conclusive' : 'inconclusive'}">${sphericalModel.errH.toFixed(1)}</td>
      <td>${sphericalModel.predD.toFixed(0)}</td>
      <td class="${Math.abs(sphericalModel.errD) <= 1609 ? 'conclusive' : 'inconclusive'}">${sphericalModel.errD.toFixed(0)}</td>
      <td class="conclusive">${sphericalStatus}</td>
    `;
    
    // Update ALL formula display values
    // Model 1: Flat Earth
    document.getElementById('thetaStarDisplay').textContent = thetaFlatEarth.toFixed(4) + '°';
    document.getElementById('thetaStarDisplay2').textContent = thetaFlatEarth.toFixed(4) + '°';
    document.getElementById('thetaStarDisplay_FE').textContent = thetaFlatEarth.toFixed(4) + '°';
    document.getElementById('distanceDisplay').textContent = distance.toLocaleString();
    document.getElementById('deltaH_FE_display').textContent = deltaH_FE.toFixed(1);
    document.getElementById('deltaHActual').textContent = deltaH.toLocaleString();
    document.getElementById('deltaHActual_FE').textContent = deltaH.toLocaleString();
    document.getElementById('distance_FE_display').textContent = distance_FE.toFixed(0);
    document.getElementById('distanceActual_FE').textContent = distance.toLocaleString();
    document.getElementById('errorH_FE_display').textContent = (errorH_FE > 0 ? '+' : '') + errorH_FE.toFixed(1);
    document.getElementById('errorD_FE_display').textContent = (errorD_FE > 0 ? '+' : '') + errorD_FE.toFixed(0);
    
    // Model 2: Heffron
    document.getElementById('distanceDisplay2').textContent = distance.toLocaleString();
    document.getElementById('distanceDisplay3').textContent = distance.toLocaleString();
    document.getElementById('distanceDisplay4').textContent = distance.toLocaleString();
    document.getElementById('distanceDisplay_Heffron').textContent = distance.toLocaleString();
    document.getElementById('radiusDisplay').textContent = R.toLocaleString();
    document.getElementById('dropDisplay').textContent = drop.toFixed(1);
    document.getElementById('dropDisplay2').textContent = drop.toFixed(1);
    document.getElementById('deltaHActual2').textContent = deltaH.toLocaleString();
    document.getElementById('deltaHActual_Heffron').textContent = deltaH.toLocaleString();
    document.getElementById('deltaHActual_Heffron2').textContent = deltaH.toLocaleString();
    document.getElementById('deltaHMinusDrop').textContent = (deltaH - drop).toFixed(1);
    document.getElementById('thetaHeffronDisplay').textContent = (thetaGlobeHeffron * 180 / Math.PI).toFixed(3) + '°';
    document.getElementById('thetaHeffronDisplay2').textContent = (thetaGlobeHeffron * 180 / Math.PI).toFixed(3) + '°';
    document.getElementById('thetaHeffronDisplay3').textContent = (thetaGlobeHeffron * 180 / Math.PI).toFixed(3) + '°';
    document.getElementById('deltaH_Heffron_display').textContent = deltaH_GE_Heffron.toFixed(0);
    document.getElementById('distance_Heffron_display').textContent = distance_GE_Heffron.toFixed(0);
    document.getElementById('distanceActual_Heffron').textContent = distance.toLocaleString();
    document.getElementById('errorH_Heffron_display').textContent = (errorH_GE_Heffron > 0 ? '+' : '') + errorH_GE_Heffron.toFixed(0);
    document.getElementById('errorD_Heffron_display').textContent = (errorD_GE_Heffron > 0 ? '+' : '') + errorD_GE_Heffron.toFixed(0);
    
    // Angle underestimation
    const angleUnderestimate = thetaTotal - (thetaGlobeHeffron * 180 / Math.PI);
    document.getElementById('angleUnderestimate').textContent = angleUnderestimate.toFixed(2);
    
    // Model 3: Spherical
    document.getElementById('distanceDisplay5').textContent = distance.toLocaleString();
    document.getElementById('radiusDisplay2').textContent = R.toLocaleString();
    document.getElementById('radiusDisplay3').textContent = R.toLocaleString();
    document.getElementById('radiusDisplay4').textContent = R.toLocaleString();
    document.getElementById('hObsDisplay').textContent = hObs.toLocaleString();
    document.getElementById('hPeakDisplay').textContent = hPeak.toLocaleString();
    document.getElementById('sigmaDisplay').textContent = sigma.toFixed(6);
    document.getElementById('sigmaDisplay2').textContent = sigma.toFixed(6);
    document.getElementById('RODisplay').textContent = RO.toLocaleString();
    document.getElementById('RODisplay2').textContent = RO.toLocaleString();
    document.getElementById('RODisplay3').textContent = RO.toLocaleString();
    document.getElementById('RPDisplay').textContent = RP.toLocaleString();
    document.getElementById('RPDisplay2').textContent = RP.toLocaleString();
    document.getElementById('RPDisplay3').textContent = RP.toLocaleString();
    document.getElementById('LDisplay').textContent = L.toFixed(1);
    
    document.getElementById('chordArcDiff').textContent = chordArcDiff.toFixed(0);
    
    document.getElementById('alphaDisplay').textContent = (alphaValue * 180 / Math.PI).toFixed(3) + '°';
    document.getElementById('thetaBaseDisplay').textContent = (thetaBaseValue * 180 / Math.PI).toFixed(3) + '°';
    document.getElementById('sigmaCorrectionDisplay').textContent = (sigma * 180 / Math.PI).toFixed(3) + '°';
    document.getElementById('thetaSphericalDisplay').textContent = (thetaGlobeSpherical * 180 / Math.PI).toFixed(3) + '°';
    
    // Step 6: Model 3 verification outputs
    console.log("Updating Step 6 displays...");
    document.getElementById('deltaH_predicted_spherical_display').textContent = deltaH_predicted_spherical.toFixed(1);
    document.getElementById('thetaPeakToStarDisplay').textContent = thetaPeakToStar.toFixed(3);
    document.getElementById('thetaHeffronToPeakDisplay').textContent = thetaHeffronToPeak.toFixed(3);
    document.getElementById('theta_measured_display').textContent = theta_Rad.toFixed(6);
    document.getElementById('deltaH_measured_spherical_display').textContent = deltaH_measured_from_angles.toFixed(1);
    document.getElementById('errorH_spherical_step6_display').textContent = (errorH_GE_Spherical > 0 ? '+' : '') + errorH_GE_Spherical.toFixed(1);
    document.getElementById('errorD_spherical_step6_display').textContent = (errorD_GE_Spherical > 0 ? '+' : '') + errorD_GE_Spherical.toFixed(1);
  }

  // Run on load
  window.onload = calculate;
</script>
</body>
</html>
